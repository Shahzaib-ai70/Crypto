<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spot Trading - BitSafe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #1f2937; }
        .text-green-custom { color: #0ECB81; }
        .bg-green-custom { background-color: #0ECB81; }
        .text-red-custom { color: #F6465D; }
        .bg-red-custom { background-color: #F6465D; }
        .bottom-nav-item.active { color: #1f2937; }
        .bottom-nav-item { color: #9ca3af; }
        /* Custom scrollbar for order book */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Depth bars animation */
        .depth-bar { transition: width 0.3s ease-in-out; }
    </style>
</head>
<body class="pb-20">

    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-3 bg-white sticky top-0 z-40 border-b border-gray-100">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-bars text-xl text-gray-600"></i>
            <div class="flex items-center gap-2">
                <h1 class="text-xl font-bold text-gray-800" id="pairDisplay">BTC/USDT</h1>
                <span id="changeDisplay" class="text-green-custom text-xs font-bold bg-green-50 px-1.5 py-0.5 rounded">+2.34%</span>
            </div>
        </div>
        <div class="flex gap-5 text-gray-500">
            <a href="quotes.html"><i class="fa-solid fa-chart-simple text-xl"></i></a>
            <i class="fa-solid fa-ellipsis-vertical text-xl"></i>
        </div>
    </div>

    <!-- Main Trading Interface -->
    <div class="flex p-2 gap-2 max-w-md mx-auto">
        
        <!-- Left Column: Order Book -->
        <div class="w-5/12 flex flex-col">
            <div class="flex justify-between text-[10px] text-gray-400 mb-2 px-1 font-medium">
                <span>Price</span>
                <span>Amount</span>
            </div>
            
            <!-- Asks (Sells) -->
            <div id="asksBook" class="flex flex-col-reverse h-[140px] overflow-hidden text-[11px]">
                <!-- Populated by JS -->
            </div>

            <!-- Current Price -->
            <div class="py-3 flex flex-col items-center justify-center my-1">
                <span id="currentPrice" class="text-xl font-bold text-green-custom">88,234.50</span>
                <span id="estPrice" class="text-[10px] text-gray-400">≈ $88,234.50</span>
            </div>

            <!-- Bids (Buys) -->
            <div id="bidsBook" class="h-[140px] overflow-hidden text-[11px]">
                <!-- Populated by JS -->
            </div>
            
            <!-- Depth Select -->
            <div class="mt-2 flex justify-between px-1">
                <div class="bg-gray-100 rounded px-2 py-1 text-[10px] text-gray-500 flex items-center gap-1 font-medium cursor-pointer">
                    <span>0.01</span>
                    <i class="fa-solid fa-caret-down"></i>
                </div>
            </div>
        </div>

        <!-- Right Column: Trading Form -->
        <div class="w-7/12 pl-2">
            
            <!-- Buy/Sell Tabs -->
            <div class="flex rounded-lg overflow-hidden mb-4 bg-gray-100 p-0.5">
                <button id="tabBuy" onclick="setSide('BUY')" class="flex-1 py-2 text-sm font-bold bg-green-custom text-white rounded shadow-sm">Buy</button>
                <button id="tabSell" onclick="setSide('SELL')" class="flex-1 py-2 text-sm font-bold text-gray-500 hover:text-gray-700">Sell</button>
            </div>

            <!-- Order Type -->
            <div class="flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2.5 mb-3 border border-gray-200 cursor-pointer">
                <span class="text-sm font-medium text-gray-700">Limit Order</span>
                <i class="fa-solid fa-caret-down text-gray-400 text-xs"></i>
            </div>

            <!-- Price Input -->
            <div class="relative mb-3">
                <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden h-11 bg-white">
                    <button class="w-10 h-full text-gray-400 hover:bg-gray-50 text-xl font-light" onclick="adjustPrice(-1)">-</button>
                    <input id="inputPrice" type="number" step="0.01" class="flex-1 text-center text-sm outline-none font-bold text-gray-800 h-full placeholder-gray-300" placeholder="Price">
                    <button class="w-10 h-full text-gray-400 hover:bg-gray-50 text-xl font-light" onclick="adjustPrice(1)">+</button>
                </div>
                <div class="text-center text-[10px] text-gray-400 mt-1" id="estUsdPrice">≈ $0.00</div>
            </div>

            <!-- Amount Input -->
            <div class="relative mb-4">
                <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden h-11 bg-white">
                    <button class="w-10 h-full text-gray-400 hover:bg-gray-50 text-xl font-light" onclick="adjustAmount(-1)">-</button>
                    <input id="inputAmount" type="number" step="0.0001" class="flex-1 text-center text-sm outline-none font-bold text-gray-800 h-full placeholder-gray-300" placeholder="Amount">
                    <button class="w-10 h-full text-gray-400 hover:bg-gray-50 text-xl font-light" onclick="adjustAmount(1)">+</button>
                </div>
            </div>

            <!-- Percentages -->
            <div class="grid grid-cols-4 gap-2 mb-4">
                <button onclick="setPercent(25)" class="py-1.5 bg-gray-100 rounded text-[10px] font-medium text-gray-500 hover:bg-gray-200 transition-colors">25%</button>
                <button onclick="setPercent(50)" class="py-1.5 bg-gray-100 rounded text-[10px] font-medium text-gray-500 hover:bg-gray-200 transition-colors">50%</button>
                <button onclick="setPercent(75)" class="py-1.5 bg-gray-100 rounded text-[10px] font-medium text-gray-500 hover:bg-gray-200 transition-colors">75%</button>
                <button onclick="setPercent(100)" class="py-1.5 bg-gray-100 rounded text-[10px] font-medium text-gray-500 hover:bg-gray-200 transition-colors">100%</button>
            </div>

            <!-- Available -->
            <div class="flex justify-between text-[11px] text-gray-500 mb-4 items-center">
                <span>Avail</span>
                <div class="flex items-center gap-1">
                    <span id="availBalance" class="text-gray-900 font-bold">1,245.00 USDT</span>
                    <i class="fa-solid fa-circle-plus text-yellow-500 text-sm"></i>
                </div>
            </div>

            <!-- Action Button -->
            <button id="btnAction" onclick="submitOrder()" class="w-full py-3.5 rounded-lg bg-green-custom text-white font-bold text-base shadow-md active:scale-95 transition-transform hover:opacity-90">
                Buy BTC
            </button>

        </div>
    </div>

    <!-- Orders Section (Tabs) -->
    <div class="mt-2 border-t border-gray-100 max-w-md mx-auto">
        <div class="flex border-b border-gray-100">
            <button class="px-4 py-3 text-sm font-bold text-gray-800 border-b-2 border-yellow-500">Open Orders (0)</button>
            <button class="px-4 py-3 text-sm font-medium text-gray-400">Funds</button>
        </div>
        <div class="p-12 text-center text-gray-300">
            <i class="fa-solid fa-clipboard-list text-5xl mb-3 opacity-50"></i>
            <p class="text-sm font-medium">No Open Orders</p>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-6 flex justify-between items-center z-50 max-w-md mx-auto">
        <a href="index.html" class="flex flex-col items-center bottom-nav-item cursor-pointer text-gray-400 hover:text-gray-900 transition-colors">
            <i class="fa-solid fa-house text-xl mb-1"></i>
            <span class="text-[10px]">Home</span>
        </a>
        <a href="quotes.html" class="flex flex-col items-center bottom-nav-item cursor-pointer text-gray-400 hover:text-gray-900 transition-colors">
            <i class="fa-solid fa-chart-simple text-xl mb-1"></i>
            <span class="text-[10px]">Quotes</span>
        </a>
        <a href="transaction.html" class="relative -top-5">
            <div class="w-12 h-12 bg-gray-900 rounded-full flex items-center justify-center shadow-lg border-4 border-white transform transition-transform hover:scale-105">
                <i class="fa-solid fa-arrow-right-arrow-left text-white text-lg transform rotate-45"></i>
            </div>
            <div class="text-center mt-1">
                <span class="text-[10px] text-gray-900 font-bold">Spot</span>
            </div>
        </a>
        <a href="futures.html" class="flex flex-col items-center bottom-nav-item cursor-pointer text-gray-400 hover:text-gray-900 transition-colors">
            <i class="fa-solid fa-file-contract text-xl mb-1"></i>
            <span class="text-[10px]">Futures</span>
        </a>
        <a href="assets.html" class="flex flex-col items-center bottom-nav-item cursor-pointer text-gray-400 hover:text-gray-900 transition-colors">
            <i class="fa-solid fa-wallet text-xl mb-1"></i>
            <span class="text-[10px]">Assets</span>
        </a>
    </div>

    <script>
        // --- SIMULATION LOGIC ---
        let basePrice = 88234.50;
        let currentPrice = basePrice;
        let currentSymbol = 'BTC';
        let currentSide = 'BUY';
        
        // Mock Balances
        let balanceUSDT = 1245.00;
        let balanceCoin = 0.0542;

        function init() {
            // Check URL for symbol
            const urlParams = new URLSearchParams(window.location.search);
            const s = urlParams.get('symbol');
            if(s) {
                currentSymbol = s.toUpperCase().replace('/','').replace('USDT','');
                // Adjust base price based on symbol (mock)
                if(currentSymbol === 'ETH') basePrice = 2980.50;
                else if(currentSymbol === 'LTC') basePrice = 76.20;
                else if(currentSymbol === 'XRP') basePrice = 1.92;
                else if(currentSymbol === 'DOGE') basePrice = 0.13;
                else if(currentSymbol === 'SOL') basePrice = 112.50;
            }
            
            currentPrice = basePrice;
            document.getElementById('pairDisplay').textContent = `${currentSymbol}/USDT`;
            document.getElementById('btnAction').textContent = `Buy ${currentSymbol}`;
            
            // Start Loops
            updateUI();
            setInterval(simulateTicker, 800);
            setInterval(simulateOrderBook, 800);
            
            // Set initial inputs
            document.getElementById('inputPrice').value = currentPrice.toFixed(2);
            document.getElementById('estUsdPrice').textContent = `≈ $${currentPrice.toFixed(2)}`;
        }

        function simulateTicker() {
            // Random Walk
            const change = (Math.random() - 0.5) * (basePrice * 0.0005);
            currentPrice += change;
            
            // Update Price Display
            const priceEl = document.getElementById('currentPrice');
            const prev = parseFloat(priceEl.textContent.replace(',',''));
            
            priceEl.textContent = formatNumber(currentPrice, 2);
            document.getElementById('estPrice').textContent = `≈ $${formatNumber(currentPrice, 2)}`;
            
            // Color update
            if(currentPrice > prev) {
                priceEl.className = "text-xl font-bold text-green-custom";
            } else {
                priceEl.className = "text-xl font-bold text-red-custom";
            }
        }

        function simulateOrderBook() {
            // Generate Asks (Sells) > Price
            const asksContainer = document.getElementById('asksBook');
            let asksHtml = '';
            for(let i=7; i>=1; i--) {
                const p = currentPrice + (i * (basePrice * 0.0001)) + (Math.random() * basePrice * 0.00005);
                const amt = (Math.random() * 2).toFixed(4);
                const width = Math.floor(Math.random() * 80) + 10;
                asksHtml += `
                    <div class="flex justify-between items-center h-[18px] relative px-1">
                        <span class="text-red-custom z-10 font-medium">${formatNumber(p, 2)}</span>
                        <span class="text-gray-500 z-10">${amt}</span>
                        <div class="absolute right-0 top-0 bottom-0 bg-red-50 opacity-60 depth-bar" style="width: ${width}%"></div>
                    </div>
                `;
            }
            asksContainer.innerHTML = asksHtml;

            // Generate Bids (Buys) < Price
            const bidsContainer = document.getElementById('bidsBook');
            let bidsHtml = '';
            for(let i=1; i<=7; i++) {
                const p = currentPrice - (i * (basePrice * 0.0001)) - (Math.random() * basePrice * 0.00005);
                const amt = (Math.random() * 2).toFixed(4);
                const width = Math.floor(Math.random() * 80) + 10;
                bidsHtml += `
                    <div class="flex justify-between items-center h-[18px] relative px-1">
                        <span class="text-green-custom z-10 font-medium">${formatNumber(p, 2)}</span>
                        <span class="text-gray-500 z-10">${amt}</span>
                        <div class="absolute right-0 top-0 bottom-0 bg-green-50 opacity-60 depth-bar" style="width: ${width}%"></div>
                    </div>
                `;
            }
            bidsContainer.innerHTML = bidsHtml;
        }

        // --- UI INTERACTION ---

        function setSide(side) {
            currentSide = side;
            const btnBuy = document.getElementById('tabBuy');
            const btnSell = document.getElementById('tabSell');
            const btnAction = document.getElementById('btnAction');
            const availEl = document.getElementById('availBalance');

            if(side === 'BUY') {
                btnBuy.className = "flex-1 py-2 text-sm font-bold bg-green-custom text-white rounded shadow-sm transition-all";
                btnSell.className = "flex-1 py-2 text-sm font-bold text-gray-500 hover:text-gray-700 transition-all bg-transparent";
                
                btnAction.className = "w-full py-3.5 rounded-lg bg-green-custom text-white font-bold text-base shadow-md active:scale-95 transition-transform hover:opacity-90";
                btnAction.textContent = `Buy ${currentSymbol}`;
                
                availEl.textContent = `${formatNumber(balanceUSDT, 2)} USDT`;
            } else {
                btnBuy.className = "flex-1 py-2 text-sm font-bold text-gray-500 hover:text-gray-700 transition-all bg-transparent";
                btnSell.className = "flex-1 py-2 text-sm font-bold bg-red-custom text-white rounded shadow-sm transition-all";
                
                btnAction.className = "w-full py-3.5 rounded-lg bg-red-custom text-white font-bold text-base shadow-md active:scale-95 transition-transform hover:opacity-90";
                btnAction.textContent = `Sell ${currentSymbol}`;
                
                availEl.textContent = `${formatNumber(balanceCoin, 4)} ${currentSymbol}`;
            }
        }

        function setPercent(pct) {
            const inputPrice = document.getElementById('inputPrice');
            const inputAmount = document.getElementById('inputAmount');
            const price = parseFloat(inputPrice.value) || currentPrice;
            
            if(price <= 0) return;

            if(currentSide === 'BUY') {
                const amount = (balanceUSDT * (pct/100)) / price;
                inputAmount.value = amount.toFixed(4);
            } else {
                const amount = balanceCoin * (pct/100);
                inputAmount.value = amount.toFixed(4);
            }
        }

        function adjustPrice(delta) {
            const input = document.getElementById('inputPrice');
            let val = parseFloat(input.value) || currentPrice;
            const tick = basePrice > 1000 ? 0.01 : 0.0001; // Adaptive tick
            val += delta * tick * 100; // Bigger steps for convenience
            if(val < 0) val = 0;
            input.value = val.toFixed(2);
            document.getElementById('estUsdPrice').textContent = `≈ $${val.toFixed(2)}`;
        }
        
        function adjustAmount(delta) {
             const input = document.getElementById('inputAmount');
             let val = parseFloat(input.value) || 0;
             val += delta * 0.0001; 
             if(val < 0) val = 0;
             input.value = val.toFixed(4);
        }

        function submitOrder() {
            const price = document.getElementById('inputPrice').value;
            const amount = document.getElementById('inputAmount').value;

            if(!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            // Mock Success
            const btn = document.getElementById('btnAction');
            const originalText = btn.textContent;
            btn.textContent = "Success!";
            setTimeout(() => {
                btn.textContent = originalText;
                alert(`Order Submitted: ${currentSide} ${amount} ${currentSymbol} @ ${price}`);
            }, 500);
        }
        
        function formatNumber(num, decimals) {
            return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }
        
        function updateUI() {
            setSide('BUY'); // Default
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>