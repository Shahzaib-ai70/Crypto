<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitsafe - Crypto Exchange</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f8f8; }
        .text-green-custom { color: #0ECB81; }
        .bg-green-custom { background-color: #0ECB81; }
        .text-yellow-custom { color: #F0B90B; }
        .bg-yellow-custom { background-color: #ffb11a; }
        .bottom-nav-item.active { color: #1f2937; }
        .bottom-nav-item { color: #9ca3af; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-20 max-w-md mx-auto bg-white min-h-screen shadow-lg overflow-x-hidden">
    <div class="p-4 flex items-center justify-between sticky top-0 bg-white z-10">
        <div id="profileBtn" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3 cursor-pointer">
            <i class="fa-solid fa-user text-gray-600 text-lg"></i>
        </div>
        <div class="flex items-center bg-gray-100 rounded-full px-3 py-2 flex-1 mr-4">
            <i class="fa-solid fa-magnifying-glass text-gray-400 mr-2"></i>
            <input type="text" placeholder="BTC/USDT" class="bg-transparent border-none outline-none text-sm w-full placeholder-gray-400">
        </div>
        <div class="relative">
            <i class="fa-solid fa-headset text-xl text-gray-700"></i>
            <span class="absolute -top-1 -right-1 bg-red-500 rounded-full w-2 h-2"></span>
        </div>
    </div>
    <div class="px-4 py-2">
        <div class="flex items-center text-gray-500 text-sm mb-1"><span>Est.Total Value(USDT)</span></div>
        <div class="flex items-center justify-between">
            <div>
                <h1 id="homeBalance" class="text-4xl font-bold text-gray-800">0.00</h1>
                <div class="flex items-center text-gray-500 text-sm mt-1"><span id="homeBalanceUsd">≈ $0.00</span></div>
                <div class="text-green-custom text-sm mt-1">0.00USDT(0%)</div>
            </div>
            <i class="fa-regular fa-eye text-gray-800 text-xl cursor-pointer" onclick="toggleBalance()"></i>
        </div>
    </div>
    <div class="px-4 py-4 flex gap-4">
        <button onclick="document.getElementById('depositModal').classList.remove('hidden')" class="flex-1 bg-yellow-custom text-gray-900 py-3 rounded-xl font-semibold flex items-center justify-center shadow-sm"><i class="fa-solid fa-wallet mr-2"></i> Deposit</button>
        <button onclick="document.getElementById('withdrawModal').classList.remove('hidden')" class="flex-1 bg-gray-100 text-gray-900 py-3 rounded-xl font-semibold flex items-center justify-center"><i class="fa-solid fa-arrow-up-from-bracket mr-2"></i> Withdraw</button>
    </div>
    <div id="depositModal" class="hidden fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-50">
        <div class="bg-white w-full max-w-md rounded-t-2xl p-6 relative animate-slide-up">
            <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 class="text-lg font-bold text-gray-800 mb-6">Select deposit method</h2>
            <a href="deposit_currency.html" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-colors">
                <div class="w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center text-white mr-4"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
                <div><div class="font-bold text-gray-800">Ordinary Deposit</div><div class="text-xs text-gray-400">Transfer from wallet or exchange</div></div>
            </a>
            <button onclick="document.getElementById('depositModal').classList.add('hidden')" class="absolute top-0 right-0 p-4 text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
    </div>
    <div id="withdrawModal" class="hidden fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-50">
        <div class="bg-white w-full max-w-md rounded-t-2xl p-6 relative animate-slide-up">
            <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 class="text-lg font-bold text-gray-800 mb-6">Select withdrawal method</h2>
            <a href="withdraw_currency.html" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-colors">
                <div class="w-10 h-10 bg-white border border-gray-200 rounded-lg flex items-center justify-center text-gray-900 mr-4"><i class="fa-solid fa-arrow-up-from-bracket"></i></div>
                <div><div class="font-bold text-gray-800">Ordinary Withdraw</div><div class="text-xs text-gray-400">Transfer from wallet or exchange</div></div>
            </a>
            <button onclick="document.getElementById('withdrawModal').classList.add('hidden')" class="absolute top-0 right-0 p-4 text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
    </div>
    <style>
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slide-up 0.3s ease-out; }
    </style>
    <div class="border-t border-b border-gray-100 py-3 px-4 flex justify-between overflow-x-auto no-scrollbar">
        <div class="flex flex-col min-w-[30%]"><span class="text-xs font-bold text-gray-800">BTC/USDT <span class="text-green-custom">+1.33%</span></span><span class="text-lg font-bold text-green-custom">88224.90</span></div>
        <div class="flex flex-col min-w-[30%]"><span class="text-xs font-bold text-gray-800">ETH/USDT <span class="text-green-custom">+2.05%</span></span><span class="text-lg font-bold text-green-custom">2982.34</span></div>
        <div class="flex flex-col min-w-[30%]"><span class="text-xs font-bold text-gray-800">XRP/USDT <span class="text-green-custom">+3.53%</span></span><span class="text-lg font-bold text-green-custom">1.9039</span></div>
    </div>
    <div class="grid grid-cols-4 gap-4 px-4 py-6">
        <div class="flex flex-col items-center"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2"><i class="fa-solid fa-robot text-gray-800 text-xl"></i></div><span class="text-xs text-gray-600">AI-Fi</span></div>
        <div class="flex flex-col items-center"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2"><i class="fa-solid fa-download text-gray-800 text-xl"></i></div><span class="text-xs text-gray-600 text-center">APP Download</span></div>
        <div class="flex flex-col items-center"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2"><i class="fa-solid fa-circle-question text-gray-800 text-xl"></i></div><span class="text-xs text-gray-600">Get Help</span></div>
        <div class="flex flex-col items-center"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2"><i class="fa-solid fa-user-plus text-gray-800 text-xl"></i></div><span class="text-xs text-gray-600">Referral</span></div>
    </div>
    <div class="px-4">
        <div class="flex space-x-6 text-gray-400 font-medium text-lg border-b border-gray-100 pb-2"><div class="text-gray-900 border-b-2 border-yellow-custom pb-1">Favorites</div><div>Fast</div><div>Spot</div><div>Perpetual</div></div>
        <div class="flex space-x-6 mt-4 text-sm text-gray-500 font-medium">
            <div id="tabCrypto" class="text-gray-900 border-b-2 border-yellow-custom pb-1 cursor-pointer">Crypto</div>
            <div id="tabStock" class="cursor-pointer">Stock</div>
            <div id="tabForex" class="cursor-pointer">Forex</div>
            <div id="tabGold" class="cursor-pointer">Gold</div>
        </div>
    </div>
    <div class="flex justify-between px-4 mt-4 text-xs text-gray-400 mb-2">
        <div class="w-1/3 text-left">Name/Volume</div>
        <div class="w-1/3 text-center">Latest Price</div>
        <div class="w-1/3 text-right">24h chg</div>
    </div>
    <div id="homeCoinList" class="px-4 space-y-6 pb-4">
        <!-- Dynamic Content -->
        <div class="text-center text-gray-400 py-4">Loading...</div>
    </div>
    <div id="profileMenu" class="hidden fixed inset-0 z-50 bg-white">
        <div class="p-4 flex items-center justify-between border-b"><button id="menuBackBtn" class="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center"><i class="fa-solid fa-arrow-left text-gray-700"></i></button><div class="relative"><i class="fa-solid fa-headset text-xl text-gray-700"></i></div></div>
        <div class="p-4">
            <div class="flex items-center gap-3 mb-4"><div class="w-12 h-12 rounded-full bg-yellow-200 flex items-center justify-center"><i class="fa-solid fa-user text-yellow-700"></i></div><div><div id="menuUserName" class="font-semibold text-gray-800">Guest</div><div id="menuUserId" class="text-xs text-gray-400">ID: —</div></div></div>
            <div class="grid grid-cols-2 gap-3 mb-6"><button class="border rounded-xl p-4 text-left"><div class="font-semibold text-gray-800 mb-1">Certificação Primária</div><div class="text-xs text-gray-400">Análise</div></button><button class="border rounded-xl p-4 text-left"><div class="font-semibold text-gray-800 mb-1">Certificação Avançada</div><div class="text-xs text-gray-400">KYC</div></button></div>
            <div class="space-y-1"><a href="#" class="flex items-center justify-between p-3"><span class="text-gray-800">Equipe</span><i class="fa-solid fa-chevron-right text-gray-400"></i></a><a href="#" class="flex items-center justify-between p-3"><span class="text-gray-800">Endereço</span><i class="fa-solid fa-chevron-right text-gray-400"></i></a><a href="#" class="flex items-center justify-between p-3"><span class="text-gray-800">Perfil de companhia</span><i class="fa-solid fa-chevron-right text-gray-400"></i></a><a href="#" class="flex items-center justify-between p-3"><span class="text-gray-800">Licença regulatória</span><i class="fa-solid fa-chevron-right text-gray-400"></i></a></div>
        </div>
        <div class="p-4"><button id="logoutBtn" class="w-full py-3 border rounded-xl text-gray-800">sair</button></div>
    </div>
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-6 flex justify-between items-center z-20 max-w-md mx-auto">
        <div class="flex flex-col items-center bottom-nav-item active text-gray-900 cursor-pointer"><i class="fa-solid fa-house text-xl mb-1"></i><span class="text-[10px]">Home Page</span></div>
        <a href="quotes.html" class="flex flex-col items-center bottom-nav-item cursor-pointer"><i class="fa-solid fa-chart-simple text-xl mb-1"></i><span class="text-[10px]">Quotes</span></a>
        <a href="transaction.html" class="relative -top-5"><div class="w-12 h-12 bg-gray-900 rounded-full flex items-center justify-center shadow-lg border-4 border-white"><i class="fa-solid fa-arrow-right-arrow-left text-white text-lg transform rotate-45"></i></div><div class="text-center mt-1"><span class="text-[10px] text-gray-500">Transaction</span></div></a>
        <a href="futures.html" class="flex flex-col items-center bottom-nav-item cursor-pointer"><i class="fa-solid fa-file-contract text-xl mb-1"></i><span class="text-[10px]">Futures</span></a>
        <a href="#" onclick="handleAssetsClick(event)" class="flex flex-col items-center bottom-nav-item cursor-pointer"><i class="fa-solid fa-wallet text-xl mb-1"></i><span class="text-[10px]">Assets</span></a>
    </div>
    <script src="translations.js"></script>
    <script>
        function isLoggedIn(){ return !!localStorage.getItem('authUser'); }
        function handleAssetsClick(e){ e.preventDefault(); if(!isLoggedIn()){ window.location.href='register.html'; } else { window.location.href='assets.html'; } }

        // Data & Meta from Quotes
        const lists = {
            crypto: ["BTCUSDT", "ETHUSDT", "BNBUSDT", "XRPUSDT", "SOLUSDT", "ADAUSDT", "DOGEUSDT", "TRXUSDT", "LTCUSDT", "DOTUSDT", "LINKUSDT", "SHIBUSDT", "AVAXUSDT", "BCHUSDT", "UNIUSDT", "MATICUSDT"],
            stock: ["AAPL", "TSLA", "GOOGL", "AMZN", "MSFT", "NVDA", "META", "NFLX"],
            forex: ["EURUSD", "GBPUSD", "USDJPY", "AUDUSD", "USDCAD"],
            gold: ["XAUUSD", "XAGUSD"]
        };
        const META = {
            // Crypto
            BTCUSDT: {sym: "BTC", img: "https://assets.coincap.io/assets/icons/btc@2x.png"},
            ETHUSDT: {sym: "ETH", img: "https://assets.coincap.io/assets/icons/eth@2x.png"},
            BNBUSDT: {sym: "BNB", img: "https://assets.coincap.io/assets/icons/bnb@2x.png"},
            XRPUSDT: {sym: "XRP", img: "https://assets.coincap.io/assets/icons/xrp@2x.png"},
            SOLUSDT: {sym: "SOL", img: "https://assets.coincap.io/assets/icons/sol@2x.png"},
            ADAUSDT: {sym: "ADA", img: "https://assets.coincap.io/assets/icons/ada@2x.png"},
            DOGEUSDT: {sym: "DOGE", img: "https://assets.coincap.io/assets/icons/doge@2x.png"},
            TRXUSDT: {sym: "TRX", img: "https://assets.coincap.io/assets/icons/trx@2x.png"},
            LTCUSDT: {sym: "LTC", img: "https://assets.coincap.io/assets/icons/ltc@2x.png"},
            DOTUSDT: {sym: "DOT", img: "https://assets.coincap.io/assets/icons/dot@2x.png"},
            LINKUSDT: {sym: "LINK", img: "https://assets.coincap.io/assets/icons/link@2x.png"},
            SHIBUSDT: {sym: "SHIB", img: "https://assets.coincap.io/assets/icons/shib@2x.png"},
            AVAXUSDT: {sym: "AVAX", img: "https://assets.coincap.io/assets/icons/avax@2x.png"},
            BCHUSDT: {sym: "BCH", img: "https://assets.coincap.io/assets/icons/bch@2x.png"},
            UNIUSDT: {sym: "UNI", img: "https://assets.coincap.io/assets/icons/uni@2x.png"},
            MATICUSDT: {sym: "MATIC", img: "https://assets.coincap.io/assets/icons/matic@2x.png"},
            // Stock
            AAPL: {sym: "AAPL", bg: "#000000", icon: "fa-brands fa-apple"},
            TSLA: {sym: "TSLA", bg: "#cc0000", text: "T"},
            GOOGL: {sym: "GOOGL", bg: "#4285F4", icon: "fa-brands fa-google"},
            AMZN: {sym: "AMZN", bg: "#FF9900", icon: "fa-brands fa-amazon"},
            MSFT: {sym: "MSFT", bg: "#00A4EF", icon: "fa-brands fa-microsoft"},
            NVDA: {sym: "NVDA", bg: "#76B900", text: "N"},
            META: {sym: "META", bg: "#0668E1", icon: "fa-brands fa-meta"},
            NFLX: {sym: "NFLX", bg: "#E50914", text: "N"},
            // Forex
            EURUSD: {sym: "EUR/USD", bg: "#003399", text: "€"},
            GBPUSD: {sym: "GBP/USD", bg: "#C8102E", text: "£"},
            USDJPY: {sym: "USD/JPY", bg: "#BC002D", text: "¥"},
            AUDUSD: {sym: "AUD/USD", bg: "#00008B", text: "A$"},
            USDCAD: {sym: "USD/CAD", bg: "#FF0000", text: "C$"},
            // Gold
            XAUUSD: {sym: "Gold", bg: "#FFD700", text: "G"},
            XAGUSD: {sym: "Silver", bg: "#C0C0C0", text: "S"}
        };

        // Mock Data State for Non-Crypto
        const mockState = {
            AAPL: { price: 175.50, change: 1.2 },
            TSLA: { price: 240.30, change: -0.5 },
            GOOGL: { price: 138.20, change: 0.8 },
            AMZN: { price: 129.40, change: 0.3 },
            MSFT: { price: 320.10, change: 1.5 },
            NVDA: { price: 460.90, change: 2.1 },
            META: { price: 305.60, change: 0.9 },
            NFLX: { price: 440.20, change: -1.1 },
            EURUSD: { price: 1.0750, change: 0.05 },
            GBPUSD: { price: 1.2530, change: -0.1 },
            USDJPY: { price: 147.80, change: 0.2 },
            AUDUSD: { price: 0.6420, change: 0.1 },
            USDCAD: { price: 1.3650, change: -0.05 },
            XAUUSD: { price: 1925.50, change: 0.4 },
            XAGUSD: { price: 23.10, change: 0.6 }
        };

        // UI Logic
        const profileMenu = document.getElementById('profileMenu');
        const profileBtn = document.getElementById('profileBtn');
        const menuBackBtn = document.getElementById('menuBackBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userNameEl = document.getElementById('menuUserName');

        // Tabs
        const tabs = {
            crypto: document.getElementById('tabCrypto'),
            stock: document.getElementById('tabStock'),
            forex: document.getElementById('tabForex'),
            gold: document.getElementById('tabGold')
        };
        let currentTab = 'crypto';

        function setActive(tabKey) {
            Object.entries(tabs).forEach(([key, el]) => {
                if (!el) return;
                if (key === tabKey) {
                    el.classList.add("text-gray-900","border-b-2","border-yellow-custom");
                    el.classList.remove("text-gray-500"); // Not strictly needed if classes are clean, but good for safety
                } else {
                    el.classList.remove("text-gray-900","border-b-2","border-yellow-custom");
                    // Assuming default state has text-gray-500 if we remove the active classes
                }
            });
            currentTab = tabKey;
            renderList();
        }

        Object.keys(tabs).forEach(key => {
            if(tabs[key]) tabs[key].addEventListener('click', () => setActive(key));
        });

        profileBtn?.addEventListener('click', () => {
             const u = localStorage.getItem('authUser'); 
             userNameEl.textContent = u ? u : 'Guest'; 
             profileMenu.classList.remove('hidden');
             fetchUserData(); // Refresh data on open
        });

        menuBackBtn?.addEventListener('click', () => { profileMenu.classList.add('hidden'); });

        logoutBtn?.addEventListener('click', () => { 
            fetch('/api/logout', { method: 'POST' })
            .finally(() => {
                localStorage.removeItem('authUser'); 
                window.location.href='login.html'; 
            });
        });

        let balanceHidden = false;
        function toggleBalance() {
            balanceHidden = !balanceHidden;
            const balEl = document.getElementById('homeBalance');
            const usdEl = document.getElementById('homeBalanceUsd');
            if(balanceHidden) {
                balEl.textContent = '****';
                usdEl.textContent = '≈ $****';
            } else {
                fetchUserData(); // Restore
            }
        }

        // Data Fetching
        function fetchUserData() {
            const u = localStorage.getItem('authUser');
            if(!u) return;
            fetch('/api/me', { headers: { 'x-user': u } })
            .then(r=>r.json())
            .then(d=>{
                if(d) {
                    if(d.balance !== undefined) {
                        if(!balanceHidden) {
                            const bal = d.balance.toFixed(2);
                            document.getElementById('homeBalance').textContent = bal;
                            document.getElementById('homeBalanceUsd').textContent = '≈ $' + bal;
                        }
                    }
                    if(d.username) userNameEl.textContent = d.username;
                    if(d.id) document.getElementById('menuUserId').textContent = 'ID: ' + d.id;
                }
            })
            .catch(console.error);
        }

        // Coin List Logic
        let cryptoData = {};
        // Initialize cryptoData for all lists
        Object.keys(lists).forEach(cat => {
             lists[cat].forEach(s => {
                 cryptoData[s] = { symbol: s, lastPrice: 0, priceChangePercent: 0 };
             });
        });

        function updateMockData(category) {
            const symbols = lists[category];
            symbols.forEach(sym => {
                const data = mockState[sym];
                if(data) {
                    // Random walk
                    const move = (Math.random() - 0.5) * (data.price * 0.002); 
                    data.price += move;
                    data.change += (Math.random() - 0.5) * 0.1;
                    
                    cryptoData[sym] = {
                        symbol: sym,
                        lastPrice: data.price,
                        priceChangePercent: data.change,
                        volume: Math.floor(Math.random() * 1000000)
                    };
                }
            });
        }

        function renderList() {
            const container = document.getElementById('homeCoinList');
            const symbols = lists[currentTab] || [];
            let html = '';
            
            symbols.forEach(sym => {
                const item = cryptoData[sym] || { lastPrice: 0, priceChangePercent: 0 };
                const meta = META[sym] || { sym: sym.replace('USDT',''), bg: '#999', text: sym[0] };
                const price = parseFloat(item.lastPrice);
                
                // Format price based on magnitude
                let priceStr = "0.00";
                if (price > 0) {
                    if (price < 1) priceStr = price.toFixed(4);
                    else if (price < 10) priceStr = price.toFixed(3);
                    else priceStr = price.toFixed(2);
                    
                    if(price < 0.001) priceStr = price.toFixed(6);
                }

                const chg = parseFloat(item.priceChangePercent).toFixed(2);
                const isUp = parseFloat(chg) >= 0;
                
                // Icon Logic
                let iconHtml = '';
                if(meta.img) {
                    iconHtml = `<img src="${meta.img}" class="w-8 h-8 rounded-full mr-2">`;
                } else if (meta.icon) {
                    iconHtml = `<div class="w-8 h-8 rounded-full flex items-center justify-center text-white mr-2" style="background-color: ${meta.bg}"><i class="${meta.icon}"></i></div>`;
                } else {
                    const bgClass = meta.bg && !meta.bg.startsWith('#') ? meta.bg : '';
                    const bgStyle = meta.bg && meta.bg.startsWith('#') ? `style="background-color:${meta.bg}"` : '';
                    iconHtml = `<div class="w-8 h-8 rounded-full flex items-center justify-center text-white mr-2 text-xs font-bold ${bgClass}" ${bgStyle}>${meta.text || sym[0]}</div>`;
                }

                html += `
                <div class="flex items-center justify-between" onclick="window.location.href='transaction.html?symbol=${sym}'">
                    <div class="flex items-center w-1/3">
                        ${iconHtml}
                        <div>
                            <div class="flex items-baseline">
                                <span class="font-bold text-gray-800 text-sm">${meta.sym}</span>
                                ${currentTab === 'crypto' ? '<span class="text-xs text-gray-400 ml-1">/USDT</span>' : ''}
                            </div>
                            <div class="text-xs text-gray-400">${Math.floor(item.volume || 0).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="w-1/3 text-center font-bold text-gray-800">${priceStr}</div>
                    <div class="w-1/3 flex justify-end">
                        <div class="${isUp ? 'bg-green-custom' : 'bg-red-custom'} text-white px-3 py-1.5 rounded text-xs font-bold w-20 text-center">
                            ${isUp ? '+' : ''}${chg}%
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        async function fetchPrices() {
            if(currentTab === 'crypto') {
                try {
                     const symbolsParam = JSON.stringify(lists.crypto);
                     const url = `/api/markets?symbols=${encodeURIComponent(symbolsParam)}`;
                     const res = await fetch(url);
                     const allData = await res.json();
                     
                     if(Array.isArray(allData)) {
                        allData.forEach(d => {
                            if(d && d.symbol && lists.crypto.includes(d.symbol)) {
                                cryptoData[d.symbol] = d;
                            }
                        });
                        renderList();
                     }
                } catch(e) { console.error(e); }
            } else {
                updateMockData(currentTab);
                renderList();
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            fetchUserData();
            fetchPrices();
            setInterval(fetchPrices, 3000); // Poll every 3s
            
            // Initial render empty/loading
            renderList();
        });
    </script>
</body>
</html>